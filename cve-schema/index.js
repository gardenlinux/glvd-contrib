import $RefParser from "@apidevtools/json-schema-ref-parser";
import { writeFile } from 'node:fs/promises';

class db_table {
  constructor(name, properties) {
    this.name = name;
    this.properties = properties;
  }
}

let tables = [];

function undefinedSafeKeys(obj) {
  if (obj === undefined) {
    return ['id'];
  } else {
    return Object.keys(obj);
  }
}

try {
  const nistCveApiSchema = 'https://csrc.nist.gov/schema/nvd/api/2.0/cve_api_json_2.0.schema';
  let mergedNistCveApiSchema = await $RefParser.dereference(nistCveApiSchema, { mutateInputSchema: false });
  await writeFile('mergedNistCveApiSchema.json', JSON.stringify(mergedNistCveApiSchema, null, 4));

  tables = Object.keys(mergedNistCveApiSchema.definitions)
    .map(def => new db_table(def, undefinedSafeKeys(mergedNistCveApiSchema.definitions[def].properties)));

} catch (err) {
  console.error(err);
}

console.log(tables);
